<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Scanner</title>

https://unpkg.com/@zxing/browser@0.1.4</script>

<style>
-content:center; background:#eee; margin:0; padding:0; }
  .container { margin-top:30px; background:white; width:90%; max-width:500px; padding:20px; border-radius:12px; text-align:center; box-shadow:0 0 10px rgba(0,0,0,0.1); }
  video { width:100%; background:black; border-radius:8px; }
  button { margin-top:15px; padding:10px 20px; background:#0066ff; color:white; border-radius:8px; border:none; font-size:16px; cursor:pointer; }
</style>
</head>

<body>

<div class="container">
  <h2>Scan Barcode</h2>
  <video id="video" playsinline></video>

  <p><b>Hasil:</b> <span id="result">(belum ada)</span></p>

  <button onclick="sendBack()">Kirim ke Power Apps</button>
</div>

<script>
const videoElem = document.getElementById("video");
const resultElem = document.getElementById("result");
const reader = new ZXingBrowser.BrowserMultiFormatReader();

(async () => {
    try {
        await navigator.mediaDevices.getUserMedia({ video: true });

        const devices = await ZXingBrowser.BrowserCodeReader.listVideoInputDevices();
        if (!devices.length) {
            resultElem.innerText = "Kamera tidak ditemukan.";
            return;
        }

        const backCam = devices.find(d => (d.label || '').toLowerCase().includes('back'))
                        || devices[0];

        reader.decodeFromVideoDevice(backCam.deviceId, "video", (res) => {
            if (res) resultElem.innerText = res.text;
        });

    } catch (err) {
        resultElem.innerText = "Kamera error: " + err.name;
        console.error(err);
    }
})();

function sendBack() {
  const v = resultElem.innerText;
  if (v === "(belum ada)") { alert("Belum ada barcode."); return; }

  const url = "https://apps.powerapps.com/play/APPIDMAS?barcode=" + encodeURIComponent(v);
  window.location.href = url;
}
</script>

</body>
</html>
